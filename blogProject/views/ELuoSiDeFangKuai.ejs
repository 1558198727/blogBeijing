<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%=title%></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="../ELuoSiDeFangKuai/css/style.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!--font-awesome-->
    <!--<link href="css/fontawesome.css" rel="stylesheet">-->
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->
    <link rel="shortcut icon" href="./img/HeadPhoto.jpg">

    <!--<script src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>-->
</head>
<body class="body">
<!-- <div>请用方向键和空格键进行操作</div> -->
<a class="btn bg-success" href="/users/qqLogin"> QQ登录</a>
<a class="btn bg-success" onclick="location.reload()"> 刷新</a>
<a class="btn bg-success" href="/"> 首页</a>
<div class="container">

    <div class="row">
        <div class="col-xs-1 left-empty"></div>
        <div class="col-xs-4">
            <div class="local-square" id="local">
                <div class="local-Title">我的游戏区域</div>
                <div class="local-game" id="local_game"></div>
                <div class="local-next" id="local_next"></div>
                <div class="local-info">
                    <div>用时：<span id="local_time">0</span>s</div>
                    <div>得分：<span id="local_score">0</span>分</div>
                    <div id="local_gameOver"> </div>
                </div>
                <div class="local-playerInfo" >
                    <img id="local_headPhoto" src="<%=session.figureurl_qq_2 %>" >
                    <h4 id="local_nickName"><%=session.nickname %></h4>
                </div>

            </div>
        </div>
        <div class="col-xs-4">
            <div class="remote-square" id="remote">
                <div class="remote-Title">对方游戏区域</div>

                <div class="remote-game" id="remote_game"></div>

                <div class="remote-next" id="remote_next"></div>
                <div class="remote-info">
                    <div>用时：<span id="remote_time">0</span>s</div>
                    <div>得分：<span id="remote_score">0</span>分</div>
                    <div id="remote_gameOver"> </div>
                </div>

                <div class="remote-playerInfo">
                    <img src="" id="remote_headPhoto" width="100px" height="100px" >
                    <h4 id="remote_nickName"></h4>
                </div>

            </div>
        </div>
        <div class="col-xs-2"></div>
    </div>
    <div class="row" >
        <div class="col-xs-12" id="waitingDiv">
            <div class="waiting h3" id="waiting"></div>
        </div>
    </div>
    <div class="row">
        <!--<div class="col-xs-2"></div>-->
        <div class="col-xs-12 controlBtns" id="">
            <button id="control-fall1" class="btn btn-facebook"><i class="ownBtn glyphicon glyphicon-cloud-download"></i></button>
            <button id="control-up" class="btn btn-primary"><i class="ownBtn glyphicon glyphicon-triangle-top"></i></button>
            <button id="control-fall2" class="btn btn-facebook"><i class="ownBtn glyphicon glyphicon-cloud-download"></i></button>
        </div>
        <!--<div class="col-xs-2"></div>-->
    </div>
    <div class="row">
        <!--<div class="col-xs-2"></div>-->
        <div class="col-xs-12 controlBtns" id="">
            <button id="control-left" class="btn btn-primary"><i class="ownBtn glyphicon glyphicon-triangle-left"></i></button>
            <button id="control-down" class="btn btn-primary"><i class="ownBtn glyphicon glyphicon-triangle-bottom"></i></button>
            <button id="control-right" class="btn btn-primary"><i class="ownBtn glyphicon glyphicon-triangle-right"></i></button>

        </div>
        <!--<div class="col-xs-2"></div>-->
    </div>
    </div>
</div>

</body>
<script src="../ELuoSiDeFangKuai/js/socket.io-2.0.4.js"></script>
<script type="text/javascript" src="../indexTwo/js/jquery.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/square.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/squareFactory.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/game.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/local.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/remote.js"></script>
<script type="text/javascript" src="../ELuoSiDeFangKuai/js/script.js"></script>
<script type="text/javascript">
$("#control-down").click(function () {
    local.control_down();
})
$("#control-up").click(function () {

    local.control_up();
})
$("#control-left").click(function () {
    local.control_left();
})

$("#control-right").click(function () {
    local.control_right();
})
//$("#control-fall1").click(function () {
//
//    local.control_fall1();
//})
//$("#control-fall2 ").click(function () {
//    local.control_fall2();
//})

</script>

<script>
    window.onload = function () {
        $("title").html("<%=title%>");

//当前窗口得到焦点
        window.onfocus = function() {
            $("title").html("诶，又好了");
            setTimeout(function () {
                $("title").html("<%=title%>");
            },300)

        };

        //当前窗口失去焦点
        window.onblur = function() {
            $("title").html("居然崩溃了！！！");
            //暂停动画或视频
        };

    }
</script>


<script type="text/javascript">

    var socket;
    //
    var local;
    var remote;
    // remote.start(2,2);
    // remote.bindEvents();

    var nickname = "<%=session.nickname%>";
    var isLogin = "<%=session.isLogin%>";
    var headUrl = "<%=session.figureurl_qq_2%>";

    // alert("请登录！" + "islogin");
    if( isLogin === "true"){
        socket = io("ws://liyunhao.cn:80");
        console.log("socket.isSocket : " + socket.isSocket);
//        alert(nickname + "已经通过QQ登录");
//          socket.emit("ILoginByQQ");
        local = new Local(socket);
        remote = new Romote(socket)
//        {nickname:nickname,headUrl:headUrl}
//          console.log("已经发送登录消息ILoginByQQ");
        socket.on("waiting",function (str) {
            document.getElementById("waiting").innerHTML = str;
        });
        // alert("已经登录！");
        socket.on("ILoginByQQ",function () {
            console.log("收到ILoginByQQ");
            socket.emit("ILoginByQQToo");
        });

        socket.on("ILoginByQQToo",function () {
            console.log("收到ILoginByQQToo");
            socket.emit("ISendMyInfo",{nickname:nickname,headUrl:headUrl});
        });

        socket.on("ISendMyInfo",function (data) {
            console.log("收到ISendMyInfo");
            document.getElementById("remote_headPhoto").src = data.headUrl;
            document.getElementById("remote_nickName").innerHTML = data.nickname;
            socket.emit("ISendMyInfoToo",{nickname:nickname,headUrl:headUrl});
//        socket = io("ws://liyunhao.cn:80");

        });
        socket.on("ISendMyInfoToo",function (data) {
            console.log("收到ISendMyInfoToo");
            document.getElementById("remote_headPhoto").src = data.headUrl;
            document.getElementById("remote_nickName").innerHTML = data.nickname;

            // socket.emit("allReady");
            // console.log("allReady We can start!");
//        socket.emit("ISendMyInfoToo",{nickname:nickname,headUrl:headUrl});
        });

//         socket.on("allReady");
    }else{
       // alert("请登录！" + "islogin" +isLogin);
    }


</script>
</html>